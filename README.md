# GRAMOPHONE

Приложение GRAMOPHONE представляет собой API сервиса для конвертации и хранения звукозаписей.

Сервис позволяет:
- добавлять новых пользователей;
- добавлять новые звукозаписи в формате WAV;
- скачивать звукозаписи в формате MP3.

В качестве базы данных используется реляционная база данных PostgreSQL.
Для взаимодействия с базой данных используется ORM SQLAlchemy.
Логика приложения построена на основе стандарта REST API.
Для документирования API используется сервис Swagger.
Для тестирования методов может быть использовано приложение Postman или сервис Swagger.


## Локальный запуск приложения

На вашем компьютере должен быть установлен doker и docker-compose.

1. Скачайте приложение.
2. Перейдите в директорию gramophone_api.
3. При первом запуске необходимо ввести команду `docker-compose up --build`. При повторном запуске достаточно ввести
`docker-compose up`.

 *Важно: При первом запуске программы в Docker, в директории в которой вы разворачиваете приложение
автоматически создаются локальные папки input, outpu, pgdata и records. Папки input и output необходимы для обмена 
 файлами приложения, развернутого в контейнере Docker и вашей локальной машины. Поэтому для загрузки файла в базу 
 данных приложения необходимо поместить этот файл в папку input. Таким образом приложение сможет скачать этот файл 
 используя путь "./static/input/yourfile.wav". Скачанные файлы будут добавляться в папку output. 
 Папки records и pgdata являются системнымиПапка record является системной, в ней будут храниться добавленные
 пользователями треки. В базе данных будут храниться ссылки на эти треки. Папка pgdata используется базой данных для
 хранения файлов СУБД на хост-машине.


## Описание методов
### /users

1. GET - позволяет получить все данные из таблицы users:  
   Для использования метода необходимо:
   - В Postman, использовать  GET запрос http:host:5000/api/user.  
   В качестве ответа вы получите JSON: 
     ```
     {
         "message": "В базе данных нет ни одного пользователя."
     }
     ``` 
        если в таблице users нет пользователей. 
     ```
     {
          "token": "6cb5bdd648e9074fcf787846d83a8f3ed2aaf0ad781cc2ca89042332959c9663",
          "id": 6,
          "username": "Вася",
          "user_uuid": "6b096c47-cc7b-4650-9861-cad491a2897c"
     }
     ```
     если в таблице users есть пользователи.
   
2. POST - позволяет добавить нового пользователя в таблицу users:  
Для использования метода необходимо:
   - В Postman, использовать  POST запрос http:host:5000/api/user. 

   В теле запроса прописать JSON вида 
   ```
   {
       "username": "Вася"
   } 
    ```
    В качестве ответа вы получите JSON: 
    ```
    {
        "token": "6cb5bdd648e9074fcf787846d83a8f3ed2aaf0ad781cc2ca89042332959c9663",
        "user_uuid": "6b096c47-cc7b-4650-9861-cad491a2897c"
    }
    ```
    В таблицу users будут добавлены 'id', 'username', 'token' и 'user_uuid' пользователя.

3. DELETE - позволяет удалить всех пользователей из таблицы users: 

    Для использования метода необходимо:
- В Postman, использовать  DELETE запрос http:host:5000/api/user. 

    В качестве ответа вы получите JSON: 
    ```
    {
        "message": "Все пользователи удалены из базы данных."
    }
    ```
  
### /record

1. GET - позволяет получить все данные из таблицы users:  
   Для использования метода необходимо:
   - В Postman, использовать  GET запрос http:host:5000/api/record.  
   В качестве ответа вы получите JSON: 
     ```
     {
         "message": "В базе данных нет ни одной записи."
     }
     ``` 
        если в таблице records нет записей. 
     ```
     {
        "id": 16,
        "record": "5bd3139b-63de-4dda-99e3-498916008565&1.mp3",
        "user_id": 7,
        "record_uuid": "5bd3139b-63de-4dda-99e3-498916008565"
     }
     ```
     если в таблице records есть пользователи.
    
    Так же метод GET позволяет скачать запись из базы данных в формате mp3. 
    Для этого необходимо перейти по ссылке полученной при добавлении записи в базу данных (см. след. пункт).
    Получится GET запрос вида:
    ```
        http://localhost:5000/api/record?id=15&user=7
    ``` 
    Результатом выполнения запроса будет JSON: 

    ```
    {
        "message": "Запись {'record_uuid': '5bd3139b-63de-4dda-99e3-498916008565'} добавлена в папку output."
    }
    ```
    Указанная в запросе запись будет добавлена в папку output.

2. POST - позволяет добавить новую запись в таблицу records:  
Для использования метода необходимо:
   - В Postman, использовать  POST запрос http:host:5000/api/record. 

   В теле запроса прописать JSON вида 
   ```
    {
        "record": "./static/input/1.wav"
        "user_id": "1"
    }
    ```

    В качестве ответа вы получите JSON:

    ```
     {
        "url": "http://localhost:5000/api/record?id=15&user=7"
     }
    ```
    Это ссылка, которая может быть использована для скачивания добавленного вами файла в формате MP3. 
    
    В таблицу records будут добавлены 'id', 'record', 'user_id' и 'record_uuid' записи.

3. DELETE - позволяет удалить все записи из таблицы records: 

    Для использования метода необходимо:
- В Postman, использовать  DELETE запрос http:host:5000/api/record. 

    В качестве ответа вы получите JSON: 
    ```
    {
        "message": "Все записи удалены из базы данных."
    }
    ```
  
Все вышеописанные методы можно использовать с помощью сервиса Swagger. Для этого при запущенном приложении необходимо
перейти по ссылке http://localhost:5000/apidocs/.
